# Docker 빌드를 위한 Jenkins 활용 소개

## 빌드란 무엇인가?

소스 코드를 실행 가능한 standalone 소프트웨어 아티팩트로 변환하는 과정 혹은 그 결과를 말함.  
가장 중요한 부분은 소스 코드 파일이 실행 코드로 변환되는 _컴파일_ 과정.  
빌드 과정은 일반적으로 빌드 도구에 의해 관리 됨.

## 빌드 방식

* 전체 빌드  
매 빌드마다 전체 코드를 포함하여 빌드.
* 증분 빌드  
변경된 코드 대상만 분리하여 빌드.  
전체 빌드보다 빠르고 리소스를 덜 사용함.  
도커의 빌드 방식도 이와 비슷함.  

## 도커의 빌드

도커는 이미지가 있어야 컨테이너 생성/동작이 가능함.  
도커 이미지를 생성하는 과정을 도커 빌드라 부르며, 이 과정에서 dockerfile이 필요함.  
이미지 내에서는 레이어 구조가 있으며, 구성 요소 별로 서로 다른 레이어에 위치하게 된다(stack 구조).  
이런 이미지를 돌리면 가장 위에 있는 이미지 레이어를 기반으로 컨테이너를 생성함.  
서로 다른 레이어들은 유니온 파일 시스템을 통해 하나의 파일 시스템으로 다뤄짐.  

## 도커 빌드 명령어

* 기본 빌드 명령어:  
`- docker build -t <생성할 이미지명> <빌드할 코드 경로>`
* dockerfile 지정을 위한 ‒f 옵션 적용:  
`- docker build -t <생성할 이미지 명> -f <dockerfile 파일명> <빌드할 코드 경로>`

## 젠킨스란?

JVM 위에서 동작하는 DevOps 자동화 워크플로우 툴.  
커스텀 워크플로우를 구현하여 CI/CD를 구현 가능.  
도커에도 적용이 가능하여 이미지 빌드, 배포가 자동화될 수 있음.  

# Gradle을 활용한 빌드 준비

## Gradle이란?

Gradle은 Groovy를 이용한 빌드 자동화 시스템이다.  
Groovy와 유사한 도메인 언어를 채용하였으며,  
현재 안드로이드 앱을 만드는데 필요한 안드로이드
스튜디오의 공식 빌드 시스템.  
Java, C/C++, 파이썬 등 여러가지
언어 지원.
build.gradle 파일로 프로젝트 내 빌드 플러그인, 종속성 등을 관리하며,  
settings.gradle 파일로 프로젝트 이름 등의 프로젝트 관련 설정들을 관리함.

## Jib이란?

Jib은 Docker 데몬 없이 + Docker 권장사항에 대한 깊은 숙달 없이도,
Java 애플리케이션에 최적화된 Docker 및 OCI 이미지를 빌드함.  
Maven 및 Gradle용 플러그인과 자바 라이브러리로 사용이 가능.  
레이어 별 종속성을 확인하고 변경된 레이어만 배포가 가능.  
배포 시 도커 파일 불필요!  

![](https://blog.kakaocdn.net/dn/btT5BC/btrapsMxbcl/iFwkWMk6dXhrTkbKVXXJG0/img.png)

## Jib 설정

* build.gradle 파일에서 jib 플러그인 추가
* build.gradle 파일에서 jib 최상위 항목 생성 후 아래에 이미지 빌드 상세를 명세

![](https://i.stack.imgur.com/pF6CQ.png)