# IaC (= Infrastructure as Code) 란?

IaC란 코드 기반의 어플리케이션을 클라우드 인프라에 쉽고 빠르게 프로비저닝하는 방법.  

* 코드를 작성한 그대로 수동 개입을 피함으로써 인프라에 배포하는 것이 빠르고 안전함.
* 깃헙과 같은 형상 관리 시스템을 통해 어플리케이션의 코드와 버전을 관리할 수 있음.
* 코드 기반이므로 모든 환경에서 일관성있게 배포 가능.
* 재사용 가능 모듈을 쉽게 제작 가능.

![](https://blog.stackpath.com/wp-content/uploads/2020/01/infrastructure-as-code.png)

개발자들이 도메인 언어 별로 인프라 사양을 작성.  
작성된 코드는 저장소에서 관리되며, 변경사항이 생긴다면 운영 서버로 자동으로 넘어감.

Terraform(= 테라폼)이 이 IaC의 대표적인 도구 중 하나이며, AWS 리소스를 프로비저닝하고자 함.

# 테라폼이란?

AWS를 비롯한 주요 클라우드 프로바이더를 지원하는 오픈 소스 프로비저닝 플랫폼.  
사람이 읽을 수 있는 선언적 구성 파일에서 인프라와 리소스를 정의하고, 인프라 수명 주기를 관리할 수 있음.  

* 여러 클라우드 플랫폼을 한 번에 인프라 관리 가능.  
각 클라우드 별 플러그인을 사용하면 테라폼 API를 통해 클라우드 플랫폼과 상호작용 가능.
* 배포 워크플로를 표준화시켜 서로 다른 프로바이더의 리소스를 모듈이라는 재사용 가능한 형태로 관리 가능.

## 테라폼 워크플로가 동작하는 기본 형태

![](https://mktg-content-api-hashicorp.vercel.app/api/assets?product=tutorials&version=main&asset=public%2Fimg%2Fterraform%2Fterraform-iac.png)

1. Init: IaC 작성 + 필요한 플러그인 초기화.
2. Plan: 코드에 명시된 인프라 설정이 구성하려는 부분과 비교해서 변경 사항을 정리. 
(= Dry Run)  
형상 관리 툴과 협업함으로써 가능.  
정상적으로 plan이 진행되면 프로비저닝이 가능하다고 판단.
3. Apply: plan에서 정리한 내용을 실제 운영 환경에 수행.

# AWS EKS란?

    AWS EKS = Amazon Elastic Kubernetes Service

쿠버네티스를 실행할 때 사용할 수 있는 관리형 서비스.  
완성된 쿠버네티스 클러스터를 알아서 만들어서 사용자에게 제공.  
고가용성을 위한 여러 서비스 위에 실행되고 있으므로 가용성도 보장.  
버전도 아마존 측에서 최신 버전으로 유지해주며, 플러그인도 최신 버전으로 항상 관리.  
테라폼을 통해 원하는 설정으로 AWS EKS 상에 프로비저닝이 가능.

# AWS 네트워크 & EKS 설계

1. VPC 생성 (Secondary CIDR 포함)
2. Subnet 및 Internet Gateway 생성
3. Route Table 생성
4. EKS Cluster 생성
5. EKS Node Group 생성
6. 파드 배포

![](../Images/4-1.practice_domain_model.PNG)

* AWS 계정 만들면 제공되는 VPC 그대로 사용.
* 고가용성을 위해 클러스터를 구성하는 두 개의 노드를 서로 다른 리전에 위치시킴.

# 실제 실습 순서

1. Security Group 생성
2. IAM Role 및 Policy 생성
3. EKS Cluster 생성
4. EKS Node Group 생성
5. AWS Configure 및 Kubeconfig 설정
6. 파드 배포

# IAM Role 이란?

## AWS IAM이란?

IAM이란 AWS 클라우드 인프라 안에서 신분과 접속/접근을 관리하기 위한 서비스다.  
크게 사용자(Users), 그룹(Groups), 역할(Roles), 정책(Policies) 으로 구성되어 있다.  

IAM 정책(Policy)은 권한을 부여하는 방법이다. 하나 이상의 AWS 리소스에 대한 어떤 작업을 수행할 수 있는지 허용 규칙을 JSON 형식으로 작성된다.
이렇게 만들어진 정책이 IAM 사용자와 그룹, 역할에 연결된다.

# 부록

## 용어 정리

* 프로비저닝: 공급, 준비, 대비, 식량 이란 의미로, IT 에서 의미는 특정 서비스를 제공받기 위하여 서비스 실행부터 시작해 서비스를 제공받기 전 단계까지 처리되는 일련의 절차